const terminalItems = [
    {
        title: "Manifesto",
        content: "The legacy of Cypherpunks existed to empower our digital sovereignty and privacy. It's 2025, and surveillance capitalism threatens our human rights once again. Time has come for our proactive measures to defend these rights.\n\nW3PN_Hacks welcomes all skilled individuals from all fields and industries to develop the tools to safeguard personal privacy. Tools that are accessible and intuitive for everyone.\n\nW3PN_Hacks embraces a technology-agnostic approach. Use the best tool for the job, where we build open-source projects that enhance privacy.\n\nUnlike traditional hackathons, W3PN_Hacks encourages open collaboration, inviting hackers from all backgrounds and skill sets. Together, we are shaping a future where privacy and safety are paramount in a digital world.\nWe are the next wave of Cypherpunks, committed to building practical privacy tools for digital self-defence and sovereignty.\nJoin us.",
        subItems: [
            {
                subtitle: "Cypherpunks inspire.",
                content: "We stand on the shoulders of giants. The work of the Cypherpunks and the global collective action of the last decades to encrypt and secure our data and internet has granted all humans freedom from control and increased personal sovereignty.\n\nIt is 2025, we are all aware that surveillance capitalism exists growing like the cancer it is. Affecting the foundational basics of human rights and freedom. Instead of shouting fire without acting upon it; W3PN calls on all of you to build the future tools to keep these malicious forces outside. Outside of our systems, our societies, our world, outside the environment we care about. These tools and applications create an immune system, a defensive line, a surveillance firewall protecting personal privacy. It shields our relationships, day-to-day challenges, and our deepest fears from the prying eyes of whom we did not consent to.\n\nAll humans need privacy, not only for their personal lives but also in their professional lives;; consider for a moment how privacy tooling protects journalists, whistleblowers, politicians, human rights activists. Encryption and digital privacy saves lives and keeps us safe.  Some of these privacy-preserving applications are not intuitive or easy to use. While many of those lives depend on it. Whether it is a politician in Myanmar, a nurse being stalked by an ex-lover, or a teenager sharing their location with their parents securely.\n\nCypherpunks build tools for those who are seeking privacy, also for those who don't know they need it or do not yet see how important privacy is. Cypherpunks build systems for both."
            },
            {
                subtitle: "Cypherpunks build.",
                content: "We all have heard the now legendary words of Eric Hughes:\n\n\"Cypherpunks write code. We know that someone has to write software to defend privacy, and since we can't get privacy unless we all do, we're going to write it. We publish our code so that our fellow Cypherpunks may practice and play with it. Our code is free for all to use, worldwide. We don't much care if you don't approve of the software we write. We know that software can't be destroyed and that a widely dispersed system can't be shut down.\" [source]\n\nFor some people, this implies a \"show me the code or STFU\" mindset, believing that only programmers and software engineers should be Cypherpunks. This perspective is flawed; for privacy to work in practice, privacy needs to be practical. It is not merely a problem solved by submitting a pull request.\n\nPrivacy applications and protocols need the skills of translators, designers, testers, writers, communications specialists, trainers, lobbyists, business developers, and educators.\n\nW3PN_Hacks invites all hackers with skills and a passion to build the tools and applications to defend our future. Support public-goods and open-source tooling to join us in improving the digital privacy of all human beings around the world. You will be joining forces with experienced blockchain hackathon winners, OG web2 hackers, software engineers, internet experts, human rights activists, researchers, and many more. Together with those passionate about creating privacy-preserving applications and resisting online surveillance."
            },
            {
                subtitle: "Cypherpunks innovate.",
                content: "W3PN_Hacks is agnostic to the technology, applications, stacks, cryptographic primitives, and architectures that are being hacked on, as long as it improves the privacy of the users and the output is fully open-sourced. We desire privacy tooling not for only one ecosystem, blockchain, or application. There are no \"protocol\" specific tracks in this hackathon. W3PN_Hacks will curate a welcoming and stimulating environment where hackers are free to build whatever project they see fit, or jump-in on other projects that are ongoing, or propose something completely new. We are intentionally breaking the mindset of traditional hackathons where \"teams\" compete for \"prizes\", and there is little connection between hackers and their projects. Our collaborative approach puts privacy impact at the core, we care for what we build whilst having fun, sharing, and learning together."
            },
            {
                subtitle: "Cypherpunks unite.",
                content: "We are the next wave. It is time for us to step up and lead by example, empower the next generation of Cypherpunks and build the tooling for digital self-defence and sovereignty. Let the software you build embody the Cypherpunk ethos of bringing practical privacy for all users. We build for users and the future, addressing challenges we observe and experience in our current world, not for some prize money and VC-baiting. We deliberately avoid the greed-driven trap of only building to raise shared holder value, increase data-mining and pump ad revenue for corporations. We invite you to build without the concern for monetisation, app-store requirements, product-market fit or having some shiny slides and a perfect pitch by a  2pm deadline. Along with this, we seek to curate an inclusive environment and break the silos of knowledge, by openly sharing and cross-pollinating ideas. Inviting hackers from all ecosystems to put their tribalism and Twitter drama aside.\n\nTogether, we can do better through open collaboration. We are building the tools we need to remain private and safe in a hostile digital reality. We are not just building apps; we are hacking our future."
            }
        ]
    },
   
    {
        title: "Technical Tracks",
        subItems: [
            {
                subtitle: "Advanced Cryptography",
                content: "Cryptography is the backbone of digital security and privacy, powering everything we do. As an academic field it is constantly evolving and advances in this field can be difficult to understand or implement.\n\nThis track evolves around utilising advanced cryptographic tools within new use cases:\n\n• MPC (Multi-Party Computation)\n• TEE (Trusted Execution Environments)\n• ZK (Zero Knowledge proofs)\n• DID (Decentralised Identity protocols)\n• FHE (Fully homomorphic encryption)"
            },
            {
                subtitle: "Applied Encryption",
                content: "How can we practically strengthen the cryptography behind the tools and services people rely on today? Enhance existing projects, revive abandoned ones, and apply new logic to proven encryption models.\n\nExamples:\n• Encrypt hidden messages within music (carnation.fm)\n• Investigating and flagging privacy technologies using outdated cryptographic libraries\n• Rejuvenating sunset projects with outdated cryptography\n• Create a privacy/encryption-focused CRM system\n• Add Threshold or Multi-signature schemes in single-sig wallets\n• Improving encryption standards for Post-Quantum Resistance\n• Adding double-ratchet or modern encryption protocols to applications \n• Governance models supporting anonymous or pseudonymous participation" 
            },
            {
                subtitle: "Censorship Resistance",
                content: "Build or empower protocols and networks that protect users and content against digital censorship by outside parties.\n\ Examples:\n• Tor Browser\n• i2p\n• mixnets (0KN, HOPR, Katzenpost, Nym, xx.network)\n• Nostr\n• Fileverse \n• BitTorrent\n• Mesh networks (Reticulum / Meshtastic)\n• Bluetooth mesh networks\n• Adding privacy to current p2p protocols \n• Privacy-First collaboration frameworks \n• Peer-2-peer Coordination applications"
            },
            {
                subtitle: "Privacy focused AI",
                content: "As AI becomes increasingly integrated into our daily lives, it is important that we can interact with it in the best possible way. User's right to privacy should be respected from all perspectives and by default.\n\nFocus Areas:\n• Protect personal files while giving AI access to your codebase\n• Utilise AI systems on sensitive information securely\n• Censorship-resistant LLMs / AI models\n• Build applications that utilise anonymous datasets\n• Disrupt AI facial recognition systems"
            },

            {
                subtitle: "Privacy & Public Goods",
                content: "How can we protect individual privacy while supporting public infrastructure and real-world impact? \nThis track explores how privacy-preserving technologies can strengthen compliance, humanitarian aid, and everyday coordination—especially where traditional systems fall short. \nYou are invited to design solutions that balance privacy, usability, and trust. \n• Privacy-first payment and humanitarian aid systems \n• Everyday coordination applications \n• Privacy-preserving tools for public goods funding and governance "
            }
                
        ]
    },
    {
        title: "Non-Technical Tracks",
        subItems: [
            {
                subtitle: "Design (UX/UI)",
                content: "We frequently hear that privacy enhancing apps and platforms have \"bad UI/UX\" and that they are not welcoming to new users in a friendly way.\n\nThis track seeks to encourage designers, marketers, and developers to improve application User Interfaces and general look-n-feel.\n\nResources:\n• zkbob.com\n• bitcoin.design/guide\n• ethereum.org/developers/docs/design-and-ux\n• dexola.com/blog/designing-user-centric-dapps-5-best-practices-for-web3-ux"
            },
            {
                subtitle: "User Onboarding",
                content: "Privacy-focused applications often suffer from proper onboarding process for new users. This track seeks to enhance the new user experience.\n\nExample Projects:\n• Improving in-app onboarding process\n• Improving app and website accessibility (WC3 standards)\n• Curation of \"2025 cryptographic best practices\" for web3 wallet devs\n• Review of the current e2e landscape in chat and social media\n• Creating video guides for protocols"
            }
        ]
    },
    {
        title: "About W3PN_hacks",
        content: "Our team has organized, judged, talks, and collaboratively won over 25 hackathons. From this perspective we decided to create a hackathon adjusted to the great and not so great experiences we had.",
        subItems: [
            {
                subtitle: "Team",
                content: `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; padding: 20px;">
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://data.web3privacy.info/img/people/mf.png" alt="mf" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">mf</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://data.web3privacy.info/img/people/cat.png" alt="cat" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">cat</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://data.web3privacy.info/img/people/pg.jpg" alt="pg" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">pg</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://web3privacy.info/core-contributors/jensei.png" alt="jensei" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">jensei</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://web3privacy.info/core-contributors/alina.jpg" alt="alina" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">alina</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://data.web3privacy.info/img/people/coinmandeer.png" alt="coinmandeer" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">coinmandeer</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://web3privacy.info/core-contributors/andreea.png" alt="Andreea" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Andreea</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://data.web3privacy.info/img/people/robert.png" alt="Robert" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Robert</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="https://data.web3privacy.info/img/people/mykola-siusko.png" alt="mykola" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">mykola</p>
                        </div>
                    </div>
                `
            },
            {
                subtitle: "Mentors & Judges",
                content: `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; padding: 20px;">
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/sebastian.png" alt="Sebastian" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Sebastian - Hopr</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/alex-1.png" alt="Alan" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Alan - Railgun </p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/alex.png" alt="Alex" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Alex - Session </p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/eleftherios.png" alt="Lftherios" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Eleftherios - Radicle </p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/bertrand.png" alt="Bertrand" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Bertrand - Celo</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/tranquil.png" alt="TranquilFlow" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">TranquilFlow - Byzantine </p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/jacob.png" alt="Jacob" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Jacob - Phylax Systems</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/owen.png" alt="Owen" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Owen - Poly </p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/bianca.png" alt="Bianca" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Bianca - Chronicle </p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/vitalik.png" alt="Vitalik" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Vitalik - Ethereum</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/giacomo.png" alt="Giacomo" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Giacomo - ZK/Encryption/PSE</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/kieran.png" alt="Kieran" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Kieran - Railgun</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/milos.png" alt="Milos" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Milos - EF</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/max.png" alt="Max" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Max - Nym</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/pentacle.png" alt="Pentacle" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Pentacle - Independent</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/anton.png" alt="Anton" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Anton - Calimero</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/cat.png" alt="Cat" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Cat - Aztec</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/antonio.png" alt="Antonio" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Antonio - Fluidkey</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/oskarth.png" alt="Oskarth" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Oskarth - Independent</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/christopher.png" alt="Christopher" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Christopher - Anoma</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/jim.png" alt="JimJim" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">JimJim.eth</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/zimt.png" alt="Zimt" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Zimt - BlockchainGov</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/miroyato.png" alt="Andreas" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Miroyato - Fileverse</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                            <img src="assets/ying.png" alt="Ying Tong" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;" />
                            <p style="margin: 0;">Ying Tong - Applied Cryptographer</p>
                        </div>
                    </div>
                `
            },
            {
                subtitle: "Web3Privacy Now",
                content: "W3PN Is a collective that fosters a culture of privacy within web3. We make privacy accessible for everyone, empowering people to learn and implement best practices effectively",
            }
        ]
       
    },
    {
        title: "Contact",
        subItems: [
            {
                subtitle: "join the community",
                content: "",
                link: "https://t.me/+AKj7mTSVcTc3N2Q0"
            },
            {
                subtitle: "help / volunteer",
                content: "",
                link: "https://t.me/+xzjA_Mw7AghmMDk0"
            },
            {
                subtitle: "sponsor / partner",
                content: "",
                link: "https://t.me/PG_CDG"
            }
        ]
    },
    {
        title: "Apply",
        content: `
            <div id="iframe-container" style="min-height:60vh; background-color: rgb(255 255 255 / 0%);">
                <iframe src="https://form.web3privacy.info/hackathon" style="border: none; width: 100%; height: 60vh;"></iframe>
            </div>
        `
    },
    {
        title: "Return Home",
        content: ""  // Empty content since we don't need it
    }
];

class TerminalUI {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
        this.selectedIndex = -1;
        this.selectedSubIndex = -1;
        this.items = [];
        this.init();
    }

    init() {
        this.renderItems();
        this.attachEventListeners();
        this.container.focus();
    }

    renderItems() {
        terminalItems.forEach((item, index) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'terminal-item';
            itemElement.setAttribute('data-index', index);
            
            // Create row container
            const row = document.createElement('div');
            row.className = 'terminal-item-row';
            
            // Add unique ID for Return Home row
            if (item.title === "Return Home") {
                row.id = "return-home-row";
                row.addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
            }
            
            const prefix = document.createElement('span');
            prefix.className = 'terminal-item-prefix';
            prefix.textContent = '>';
            
            const title = document.createElement('span');
            title.className = 'terminal-item-title';
            title.textContent = item.title;
            
            // Add prefix and title to row
            row.appendChild(prefix);
            row.appendChild(title);
            
            // Add row to item
            itemElement.appendChild(row);
            
            // Handle content based on whether it's a single content or has subitems
            const contentContainer = document.createElement('div');
            contentContainer.className = 'terminal-item-content';
            
            // Add special styling for the Apply section
            if (item.title === "Apply") {
                contentContainer.style.backgroundColor = "rgb(255 255 255 / 0%)";
            }
            
            // Add main content if it exists
            if (item.content) {
                const mainContent = document.createElement('div');
                mainContent.className = 'terminal-main-content';
                mainContent.innerHTML = item.content;
                contentContainer.appendChild(mainContent);
            }
            
            if (item.subItems) {
                item.subItems.forEach((subItem, subIndex) => {
                    const subItemContainer = document.createElement('div');
                    subItemContainer.className = 'terminal-subitem';
                    subItemContainer.setAttribute('data-subindex', subIndex);
                    
                    const subtitleRow = document.createElement('div');
                    subtitleRow.className = 'terminal-subtitle-row';
                    
                    const subPrefix = document.createElement('span');
                    subPrefix.className = 'terminal-item-prefix';
                    subPrefix.textContent = '>';
                    
                    const subtitle = document.createElement('div');
                    subtitle.className = 'terminal-subtitle';
                    subtitle.textContent = subItem.subtitle;
                    
                    // Add special styling for subtitles with links
                    if (subItem.link) {
                        subtitle.style.color = '#4da3ff';
                        subtitle.style.cursor = 'pointer';
                        subtitle.style.textDecoration = 'underline';
                    }
                    
                    subtitleRow.appendChild(subPrefix);
                    subtitleRow.appendChild(subtitle);
                    
                    const subContent = document.createElement('div');
                    subContent.className = 'terminal-subcontent';
                    subContent.innerHTML = subItem.content;
                    
                    subItemContainer.appendChild(subtitleRow);
                    subItemContainer.appendChild(subContent);
                    contentContainer.appendChild(subItemContainer);

                    // Add click handler for subtitle
                    subtitleRow.addEventListener('click', (e) => {
                        e.stopPropagation();
                        
                        // If there's a link in the subItem, navigate to it
                        if (subItem.link) {
                            window.open(subItem.link, '_blank');
                            return;
                        }
                        
                        this.toggleSubItem(subItemContainer);
                    });
                });
            }
            
            itemElement.appendChild(contentContainer);
            this.container.appendChild(itemElement);
            this.items.push(itemElement);
        });
    }

    attachEventListeners() {
        this.container.addEventListener('keydown', this.handleKeyDown.bind(this));
        
        this.items.forEach(item => {
            const row = item.querySelector('.terminal-item-row');
            row.addEventListener('click', () => {
                const index = parseInt(item.getAttribute('data-index'));
                this.selectItem(index);
                this.toggleExpand(index);
            });
        });
    }

    handleKeyDown(event) {
        const currentItem = this.items[this.selectedIndex];
        const isSubItemsExpanded = currentItem?.classList.contains('expanded');
        const subItems = currentItem?.querySelectorAll('.terminal-subitem');
        
        switch(event.key) {
            case 'ArrowUp':
                event.preventDefault();
                if (isSubItemsExpanded && this.selectedSubIndex > 0) {
                    this.selectSubItem(this.selectedSubIndex - 1);
                } else {
                    this.moveSelection(-1);
                    this.selectedSubIndex = -1;
                }
                break;
            case 'ArrowDown':
                event.preventDefault();
                if (isSubItemsExpanded && this.selectedSubIndex < (subItems?.length || 0) - 1) {
                    this.selectSubItem(this.selectedSubIndex + 1);
                } else {
                    this.moveSelection(1);
                    this.selectedSubIndex = -1;
                }
                break;
            case 'ArrowRight':
                event.preventDefault();
                if (this.selectedIndex >= 0) {
                    if (!isSubItemsExpanded) {
                        this.expandItem(this.selectedIndex);
                    } else if (this.selectedSubIndex >= 0) {
                        this.expandSubItem(subItems[this.selectedSubIndex]);
                    }
                }
                break;
            case 'ArrowLeft':
                event.preventDefault();
                if (this.selectedIndex >= 0) {
                    if (this.selectedSubIndex >= 0) {
                        this.collapseSubItem(subItems[this.selectedSubIndex]);
                    } else {
                        this.collapseItem(this.selectedIndex);
                    }
                }
                break;
            case 'Enter':
                event.preventDefault();
                if (this.selectedIndex >= 0) {
                    if (this.selectedSubIndex >= 0 && subItems) {
                        // Get the current terminalItem and subItem
                        const terminalItem = terminalItems[this.selectedIndex];
                        const subItem = terminalItem.subItems[this.selectedSubIndex];
                        
                        // If there's a link, navigate to it
                        if (subItem.link) {
                            window.open(subItem.link, '_blank');
                            return;
                        }
                        
                        this.toggleSubItem(subItems[this.selectedSubIndex]);
                    } else {
                        this.toggleExpand(this.selectedIndex);
                    }
                }
                break;
            case 'Escape':
                event.preventDefault();
                this.collapseAll();
                break;
        }
    }

    moveSelection(direction) {
        const newIndex = this.selectedIndex + direction;
        if (newIndex >= -1 && newIndex < this.items.length) {
            this.selectItem(newIndex);
            this.selectedSubIndex = -1;
        }
    }

    selectItem(index) {
        if (this.selectedIndex >= 0) {
            this.items[this.selectedIndex].classList.remove('selected');
            this.clearSubItemSelection();
        }
        
        this.selectedIndex = index;
        
        if (index >= 0) {
            this.items[index].classList.add('selected');
            this.items[index].scrollIntoView({ block: 'nearest' });
        }
    }

    selectSubItem(subIndex) {
        const currentItem = this.items[this.selectedIndex];
        if (!currentItem) return;

        const subItems = currentItem.querySelectorAll('.terminal-subitem');
        
        if (this.selectedSubIndex >= 0) {
            subItems[this.selectedSubIndex].classList.remove('selected');
        }
        
        this.selectedSubIndex = subIndex;
        
        if (subIndex >= 0 && subIndex < subItems.length) {
            subItems[subIndex].classList.add('selected');
            subItems[subIndex].scrollIntoView({ block: 'nearest' });
        }
    }

    clearSubItemSelection() {
        if (this.selectedIndex >= 0) {
            const subItems = this.items[this.selectedIndex].querySelectorAll('.terminal-subitem');
            subItems.forEach(item => item.classList.remove('selected'));
        }
        this.selectedSubIndex = -1;
    }

    expandItem(index) {
        const item = this.items[index];
        if (!item.classList.contains('expanded')) {
            item.classList.add('expanded');
            const prefix = item.querySelector('.terminal-item-prefix');
            prefix.textContent = 'v';
        }
    }

    collapseItem(index) {
        const item = this.items[index];
        if (item.classList.contains('expanded')) {
            item.classList.remove('expanded');
            const prefix = item.querySelector('.terminal-item-prefix');
            prefix.textContent = '>';
            this.clearSubItemSelection();
        }
    }

    toggleExpand(index) {
        const item = this.items[index];
        if (item.classList.contains('expanded')) {
            this.collapseItem(index);
        } else {
            this.expandItem(index);
        }
    }

    expandSubItem(subItem) {
        if (!subItem.classList.contains('expanded')) {
            subItem.classList.add('expanded');
            const prefix = subItem.querySelector('.terminal-item-prefix');
            prefix.textContent = 'v';
        }
    }

    collapseSubItem(subItem) {
        if (subItem.classList.contains('expanded')) {
            subItem.classList.remove('expanded');
            const prefix = subItem.querySelector('.terminal-item-prefix');
            prefix.textContent = '>';
        }
    }

    toggleSubItem(subItem) {
        if (subItem.classList.contains('expanded')) {
            this.collapseSubItem(subItem);
        } else {
            this.expandSubItem(subItem);
        }
    }

    collapseAll() {
        this.items.forEach((item, index) => {
            this.collapseItem(index);
            const subItems = item.querySelectorAll('.terminal-subitem');
            subItems.forEach(subItem => this.collapseSubItem(subItem));
        });
        this.clearSubItemSelection();
    }
}

// Initialize the terminal UI when the page loads
document.addEventListener('DOMContentLoaded', () => {
    new TerminalUI('terminal-content');
}); 
